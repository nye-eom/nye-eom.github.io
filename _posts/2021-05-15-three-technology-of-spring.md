---
layout: post
title: "Spring의 대표적인 기술?"
author: nyeom
tags: [Java,Spring Framework]
---

Spring의 대표적인 기술로는 제어의 역전(IoC/DI), AOP, PSA를 들 수 있다. 

### 제어의 역전(IoC/DI)

스프링의 대표적인 기술 중 하나로 템플릿/콜백 패턴이 IoC/DI의 핵심원리이다. DI는 OCP(개방 폐쇄 원칙)이라는 객체지향 원칙으로 잘 설명 될 수 있다.   

- 핵심기능의 변경
    
    - DI의 가장 대표적인 적용 방법은 의존 대상의 구현을 바꾸는 것이다. 예를 들어 DAO의 구현을 JDBC로 했다가 그것을 JPA, Hibernate, JDO, IBatis 등으로 구현 방식을 통째로 바꾸는 것이다. 이와 같이 실제 의존하는 대상이 가진 핵심 기능을 DI 설정을 통해 변경하는 것이 대표적인 DI 활용 방법이다.
    
- 핵심기능의 동적인 변경
    
    - DI도 기본적으로는 런타임시에 동적으로 의존 오브젝트를 연결해 주지만 일단 DI되고 나면 그 후로는 바뀌지 않는다. 즉 동적인 방식으로 연결되지만 한번 DI 되면 바뀌지 않는 정적인 관계를 맺어주는 것이다. 예를 들어 사용자 등급에 따라 다른 DataSource를 사용하게 할 수 있다. DAO는 DataSource에 의존한다. (DAO → DataSource) 사용자 등급에 따라 그때그때 다른 DataSource를 dao가 사용할 수도 있다. 또 다른 예로는 사용자별로 모두 독립적인 의존오브젝트를 두게 만들 수도 있다. 한번 로그인한 사용자는 로그아웃하거나 다른 브라우저로 다시 들어오기 전에는 계속 자신만의 오브젝트를 유지하게 하고 서비스 오브젝트가 이를 DI 받아서 사용하게 할 수 있다. 매번 요청이 있을 때마다 새로운 오브젝트가 필요하다면 new를 이용해 새로 만들어도 되겠지만 한번 로그인한 사용자에게는 계속 같은 오브젝트가 적용되려면 DI를 이용하는 방식이 편하다.
    
    - 기술적인 예로는 다이내믹 라우팅 프록시나 프록시 오브젝트 기법을 들 수 있다.
    
- 부가기능의 추가
    
    - 핵심기능은 그대로 둔채 부가기능을 추가하는 것이 가능하다. 실제 사용할 오브젝트는 외부에서 주입하는 DI를 적용해두면 데코레이션 패턴을 쉽게 적용할 수 있다. 대표적인 예로는 트랜잭션 기능을 들 수 있다. 핵심 기능은 그대로 둔 채로 결과나 전달 파라미터를 조작할 수 있고 리턴 결과를 활용해 로깅이나 보안 처리 등 부가적인 작업 수행이 가능하다. 
    
- 인터페이스 변경
    
    - 디자인패턴에서 말하는 오브젝트 방식의 어댑터 패턴의 응용이라 볼 수 있다. DI의 응용 방법 중 하나이자 스프링의 대표적인 기술로 분류되는 일관성 있는 서비스 추상화(PSA)가 그런 방법이다. PSA는 클라이언트가 일관성있게 사용할 수 있는 인터페이스를 정의해주고 DI를 통해 어탭터 역할을 하는 오브젝트를 이용하게 해준다. 
    
- 프록시
    
    - 필요한 시점에서 실제 사용할 오브젝트를 초기화하고 리소스를 준비하게 해주는 지연된 로딩(lazy loading)을 적용하려면 프록시가 필요하다. 원격 프로젝트를 호출할 때 마치 로컬에 존재하는 오브젝트처럼 사용할 수 있게 해주는 원격 프록시를 적용하려고 할 때도 프록시가 필요하다. 스프링은 EJB 원격 호출을 포함해서 웹서비스, REST 호출, HTTP 방식의 호출 등 다양한 리모팅 기술을 지원한다.
    
- 템플릿과 콜백
    
    - 콜백을 템플릿에 주입하는 방식으로 동작하게 하는 것이 DI의 원리에 가장 충실한 응용 방법이다. 
    
- 싱글톤과 오브젝트 스코프
    
    - DI가 필요한 중요한 이유 중 한가지는 DI 할 오브젝트의 생명주기를 제어할 수 있다는 것이다. DI 프레임워크를 이용한다는 것은 DI 대상 오브젝트를 컨테이너가 관리한다는 의미이다. 오브젝트의 생성부터 관계설정, 이용, 소멸에 이르기까지의 모든 과정을 DI 컨테이너가 주관하기 때문에 그 오브젝트의 스코프를 자유롭게 제어할 수 있다. 
    
    - 가장 기본이 되는 스코프는 싱글톤이다. 하나 또는 소수의 오브젝트가 수많은 클라이언트의 요청에 의해 호출된다. 상태를 갖지 않도록 만든 오브젝트가 동시에 여러 스레드의 요청을 처리하는 방식을 적용하려면 만들어지는 오브젝트의 개수를 제어하는 일이 매우 중요하다. 스프링의 DI는 기본적으로 기본적으로 싱글톤 오브젝트를 만들어 사용해 클래스 자체는 싱글톤을 고려하지 않고 자유롭게 설계할 수 있다. 스프링에서는 싱글톤 외에도 임의의 생명주기를 갖는 오브젝트가 필요할 때가 있다. 따라서 다양한 스코프를 갖는 오브젝트를 만들어 DI에 사용 가능하다. HTTP 요청당 하나의 오브젝트가 만들어지거나 HTTP 세션당 하나의 오브젝트가 만들어지게 할 수 있다. 

- 테스트

### AOP
에스팩트 지향 프로그래밍은 스프링 3대 가능기술의 하나로 객체지향 기술의 한계와 단점을 극복하도록 도와주는 보조적인 프로그래밍 기술이다. IoC/DI를 이용해 POJO에 선언적인 엔터프라이즈 서비스를 제공할 수 있지만 일부 서비스는 순수한 객체지향 기법만으로는 POJO의 조건을 유지한 채로 적용하기 힘들다. AOP는 스프링이 POJO 프로그래밍을 지원하려는 그 핵심 목적을 위해 중요한 역할을 하고 있다. 

- AOP 적용 기법
    - AOP를 자바 언어에 적용하는 기법은 두가지로 분류 가능하다. 
        - 스프링과 같이 다이내믹 프록시를 사용하는 방법
            - 기존 코드에 영향을 주지 않고 부가기능을 적용하게 해주는 데코레이션 기법을 활용한다. 대신 부가기능을 부여할 수 있는 곳은 메소드의 호출이 일어나는 지점뿐이다.
        - 자바 언어의 한계를 넘어서는 언어의 확장을 이용하는 방법
            - AspectJ라는 유명한 오픈소스 AOP 툴을 활용한다. 메서드 호출뿐 아니라 인스턴스 생성, 필드 액세스, 특정 호출 경로를 가진 메소드 호출 등에도 부가 기능을 제공할 수 있다.

- AOP 적용 단계
    - 미리 준비된 AOP 이용
        - 스프링이 직접 제공하는 대표적인 AOP는 바로 트랜잭션이다.  또한 @Configurable 애노테이션을 이용해서 도메인 오브젝트에 DI를 직접 적용해주는 AOP 기능이 있다. 프록시 AOP면 충분한 트랜잭션과 달리 @Configurable을 위해서는 AspectJ를 이용한 AOP가 반드시 필요하다. 
    - 전달팀을 통한 정책 AOP
        - 대표적으로 비즈니스 로직을 가진 오브젝트에 대한 보안, 특정 계층의 오브젝트 이용전후의 작업기록을 남기는 로깅, 데이터 추적을 위한 트레이싱, 특정 구간의 실시간 성능 모니터링과 같은 정책적으로 적용할 만한 기능에 AOP를 이용하는 것이다. 
    - AOP의 자유로운 이용

### PSA
PSA는 Portable Service Abstraction으로 환경과 세부 기술의 변화에 관계없이 일관된 방식으로 기술에 접근할 수 있게 해주는 기술이다. 예를 들어 트랜잭션 서비스 추상화는 코드를 이용해 트랜잭션을 제어하지 않는다면 직접 이용할 이유가 없다. 트랜잭션은 대부분 AOP를 이용해 적용하기 때문에 직접 코드를 만들지 않기 때문이다. 대신 설정에서는 스프링의 트랜잭션 추상화 인터페이스인 PlatformTransactionManager를 구현한 구체적인 서비스 클래스를 빈으로 등록해줘야 한다. JTA를 이용해 트랜잭션을 적용하고 싶다면 JtaTransactionManager를 빈으로 등록하고 JTA 환경에 대한 설정을 프로퍼티로 넣어주면 된다. 

서비스 추상화는 단지 구체적인 기술에 종속되지 않게 하기 위해서만 사용되는 건 아니다. 테스트가 어렵게 만들어진 API나 설정을 통해 주요 기능을 외부에서 제어하게 만들고 싶을 때도 이용할 수 있다.